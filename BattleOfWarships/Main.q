[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=115
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=ed06932a-7807-4b5d-a31f-d61e83527126
Description=带界面
Enable=0
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=Form1
[Relative]
SetupOCXFile=
[Comment]

[UIPackage]
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


[Script]
'------------------------------------------------
'本部分为图形界面部分
'------------------------------------------------
CenterOfScreenX = 184
CenterOfScreenY = 370

ImagePath = ""
TimePlanFirstRun = 0
TimePlanDelay = 0
AttackCounter = 0

InitialX=0
InitialY=0
FindImageintX=0
FindImageintY=0
FindImageOffsetX = 455
FindImageOffsetY = 765

InitialX_ = 0
InitialY_ = 0

Event Form1.Button1.Click

    If Form1.Slider1.Value = 0 Then 
        Call Show2User("系统默认攻击25个海盗")
        Form1.Slider1.Value = 30
    End If
    If Form1.Slider2.Value = 0 Then 
        Call Show2User("系统默认延迟2个小时")
        Form1.Slider2.Value = 7200
    End If
    If Form1.CheckBox1.Value = 1 Then 
        Call Show2User("用户选中-立即攻打海盗-")
    Else 
        Call Show2User("用户取消-立即攻打海盗-")
    End If
    Call Show2User("系统启动")
    Form1.Slider1.Enabled = 0
    Form1.Slider2.Enabled = 0
    Form1.CheckBox1.Enabled = 0
    Form1.Button1.Enabled = 0
End Event

Event Form1.Timer1.Timer
    Form1.Label2.Caption = Form1.Slider1.Value
    Form1.Label4.Caption = Second2TimeString(Form1.Slider2.Value)
End Event

Function Second2TimeString(Second)
    Second2TimeString = ""
    Second2TimeString = Second2TimeString & int(Second / 3600)
    Second = Second MOD 3600
    
    Second2TimeString = Second2TimeString + ":"
    Second2TimeString = Second2TimeString & int(Second / 60)
    Second = Second MOD 60
    
    Second2TimeString = Second2TimeString + ":"
    Second2TimeString = Second2TimeString & int(Second)
    
End Function

Function Show2User(Inf)
    vbCrLfCnt = 0
    For i = 1 To Len(Form1.InputBox1.Text)
        Char = Mid(Form1.InputBox1.Text, i, 1)
        If Char = vbLf Then 
            vbCrLfCnt = vbCrLfCnt + 1
        End if
    Next
    If vbCrLfCnt >= 7 Then 
        Form1.InputBox1.Text = Split(Form1.InputBox1.Text, vbCrLf, 2)(1)
    End If
    Form1.Label6.Caption = Inf
    Form1.InputBox1.Text = Form1.InputBox1.Text + Inf + vbCrLf
End Function

'向用户显示倒计时（百分比显示）
'Inf显示的信息
'延迟长度（秒）
'测试 Call Show2UserCountdown("XBSJHGJDHGDJ.....",200)
Function Show2UserCountdown(Inf,Length)
    Countdown = 0
    Countdown_ = 0
    For Length
        Delay 1000
        Countdown = Countdown + 1
        Countdown_ = Countdown_ + 1
        If Countdown_ >= Length / 100 Then 
            Countdown_ = 0
            Str = Inf & int(Countdown * 100 / Length) & "%"
            Show2User (Str)
        End If
    Next
End Function

Event Form1.CheckBox1.Click
    If Form1.CheckBox1.Value = 1 Then 
        Call Show2User("用户选中-立即攻打海盗-")
    Else 
        Call Show2User("用户取消-立即攻打海盗-")
    End If
End Event

'记录到文件，按照日期排序
Function Log(Inf)
    FileName = year(Date) & "-" & Month(Date) & "-" & Day(Date) & "-" & "Log.txt"
    Dim fso, f
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set f = fso.OpenTextFile(ImagePath & FileName, 8, True)
    f.WriteLine Date & "-" & Time & " : " & Inf
    f.Close
End Function

'记录攻击海盗事件
function LogOfAttack(Level)
    Call Show2User("成功攻击一次" & Level & "海盗")
    Call Log("成功攻击一次" & Level & "海盗")
End Function

'声音报警
Function Warning2User(cnt)
    For cnt
        Call Plugin.Media.Beep(1976, 100)
        Delay 200
    Next 
End Function

'本部分为游戏辅助部分

ImagePath = "C:\Users\Zhaojingyangchun\Desktop\游戏辅助\2\"

Call SynthesisTask()

'从UI更新数据，只在程序运行的第一次使用
Function ReloadParam1()
    ImagePath = Form1.InputBox2.Text
    TimePlanFirstRun = Form1.CheckBox1.Value
    '如下两个参数首次有效
    AttackCounter = Form1.Slider1.Value
    TimePlanDelay = Form1.Slider2.Value
End Function

'重新装填数据，周期型调用
Function ReloadParam2()
    '默认延迟两个小时
    Form1.Slider2.Value = 7200
    TimePlanDelay = 7200
    '默认攻击25个海盗
    Form1.Slider1.Value = 30
    AttackCounter = 30
    Form1.InputBox2.Text = ImagePath
    Form1.CheckBox1.Value = TimePlanFirstRun
End Function

'初始化一些参数
Function Init()
    InitialX=0
    InitialY=0
    FindImageintX=0
    FindImageintY=0
End Function

'重新设定图片寻找区域
Function FindImageParamReset(OffsetX,OffsetY)
    InitialX_ = InitialX
    InitialY_ = InitialY
    InitialX = FindImageintX
    InitialY = FindImageintY
    FindImageOffsetX = OffsetX
    FindImageOffsetY = OffsetY
End function

'恢复图片寻找区域
Function FindImageParamRecovery()
    InitialX = InitialX_
    InitialY = InitialY_
    FindImageOffsetX = 455
    FindImageOffsetY = 765
End function

'寻找图片
'基本功能同FindImage，不同之处在于，这里可以设定搜索范围 
'测试：FindImage2("待命中",5,1,0.7,InitialX,InitialY,InitialX+150,InitialY+80)
Function FindImage2(ImageName,Retry,rDelay,Rate,X1,Y1,X2,Y2)
    FindImage2 = 0
    while True
        FindPic X1,Y1,X2,Y2,ImagePath+ImageName+".bmp", Rate,FindImageintX,FindImageintY
        If FindImageintX> 0 And FindImageintY> 0 Then
            FindImage2 = 1
            Exit Function
        End if
        '重试
        Retry = Retry - 1
        If Retry > 0 Then
            Delay rDelay * 1000
        Else 
            Exit Function
        End If
    Wend
End function

'寻找图片
'ImageName  图片名称（此处尽量用中文名字方便理解）
'Retry      重试次数
'rDelay     重试延迟
'Rate       图片匹配率
'如果找到函数返回1，并把图片坐标存储到FindImageintX/Y
Function FindImage(ImageName,Retry,rDelay,Rate)
    FindImage = 0
    While True
        '如果没有定位过，需要全屏查找
        if InitialX=0 and InitialY=0 Then
            FindPic 0, 0, 1366, 768, ImagePath + ImageName + ".bmp", Rate, FindImageintX, FindImageintY
        Else
            FindPic InitialX,InitialY,InitialX+FindImageOffsetX,InitialY+FindImageOffsetY,ImagePath+ImageName+".bmp", _
            Rate,FindImageintX,FindImageintY
        End if
        If FindImageintX> 0 And FindImageintY> 0 Then
            FindImage = 1
            Exit Function
        End If
        
        Retry = Retry - 1
        If Retry > 0 Then
            Delay rDelay * 1000
        Else 
            Exit Function
        End If
    Wend
End Function

'关闭游戏
Function CloseGame()
    Call Show2User("开始关闭游戏")
    While 1
        If FindImage("返回键", 1, 0, 0.9) = 1 Then 
            Call ClickAndDelay(15,15, 2, 2)
            If FindImage("确定退出游戏", 1, 0, 0.9) = 1 Then 
                Call ClickAndDelay(10,10, 2, 2)
                Exit Function
            End If
        End If
        Delay 1000
    Wend
    Call Show2User("游戏已经关闭")
End Function

'点击返回键
function PressReturnKey()
    Call Show2User("返回键")
    If FindImage("返回键", 1, 0, 0.9) = 1 Then 
        Call ClickAndDelay(10,10, 1, 1)
    end if
End function

'定位天天模拟器的位置
function LocateTiantian()
    LocateTiantian = 0
    For 5
        if FindImage("TianTian",5,1,1.0) = 1 Then
            InitialX = FindImageintX
            InitialY = FindImageintY
            '???需要定位完成需要抹掉记录??--Bug
            MoveTo InitialX - 32, InitialY + 503
            Delay 200
            LocateTiantian = 1
            Exit Function 
        Else 
            Call Warning2User(25)
            MsgBox  "找不到天天模拟器，，，，，"
        End If
    Next 
end function

'判断游戏是否在运行
function IsGameRuning()
    IsGameRuning=0
    if FindImage("Run1",2,1,0.8)=1 Or FindImage("Run2",2,1,0.8)=1 Then
        IsGameRuning=1
    End if
End function

'点击+延迟
'OffsetX        坐标偏移
'OffsetY        坐标偏移
'DelayBefore    点击之前延迟
'DelayAfter     点击之后延迟
function ClickAndDelay(OffsetX,OffsetY,DelayBefore,DelayAfter)
    MoveTo FindImageintX+OffsetX,FindImageintY+OffsetY
    Delay DelayBefore*1000
    LeftClick 1
    Delay 500
    '不遮挡图片
    MoveTo InitialX - 32, InitialY + 503
    Delay DelayAfter * 1000
end function

'拖拽：起点x，y，次数，步数，步长x，y
Function Drag(x, y, Cnt, Steps, LenX, LenY)
    For Cnt
        MoveTo InitialX+x, InitialY+y
        Delay 500
        LeftDown 1
        Delay 500
        For Steps
            MoveR LenX,LenY 
            Delay 20
        Next
        Delay 500
        LeftUp 1
    Next
    MoveTo InitialX+x, InitialY+y
    Delay 1000
End Function

'将航母列表拉到头
function ShowCarrier()
    call Drag(206,375,5,150,0,2)
End Function

'将飞机列表向下移动
function ShowPlane()
    call Drag(206,375,1,70,0,-2)
end function

'确保游戏在运行
Function EnsureGameRuning()
    EnsureGameRuningCnt = 0
    EnsureGameRuning=0
    if IsGameRuning()=0 Then
        If FindImage("GameIcon", 2, 2, 0.6) = 1 Then 
            Call Show2User("启动游戏,请等待2分钟")
            Call ClickAndDelay(15, 15, 1, 1)
            call Show2UserCountdown("游戏正在启动，进度.........",2*60)
        Else 
            Call FindImage("返回键", 2, 2, 0.9)
            call ClickAndDelay(20,20,1,1)
        end if
    Else 
        EnsureGameRuning=1
    End if
end function

'确保我们在基地外部
function EnsureOutOfBase()
    EnsureOutOfBase = 0
    For 5
        if FindImage("Run2",1,0,0.8)=1 Then 
            EnsureOutOfBase = 1
            Exit For
        End if
        if EnsureOutOfBase=0 Then
            If FindImage("Run1", 1, 0, 0.8) = 0 Then 
                call PressReturnKey()
            Else 
                call ClickAndDelay(15,15,1,3)
            End If
            
        End If
    Next 
end function

'确保我们在基地内部
Function EnsureInBase()
    EnsureInBase = 0
    For 5
        if FindImage("Run1",1,0,0.8)=1 Then 
            EnsureInBase = 1
            Exit For
        End if
        if EnsureInBase=0 Then
            If FindImage("Run2", 1, 0, 0.8) = 0 Then 
                call PressReturnKey()
            Else 
                call ClickAndDelay(15,15,1,3)
            End If
            
        End If
    Next 
End Function

'通过海盗通缉令寻找海盗
'NameOfPirate 海盗名称：东海海盗 地中海海盗 索马里海盗
'返回1表示已经找到对应的海盗
function SearchPiratesByMonsterWanted(NameOfPirate)
    SearchPiratesCnt = 0
    SearchPiratesTemp = 0
    SearchPiratesByMonsterWanted = 0
    '确保我们在基地外部
    call EnsureOutOfBase()
    '点击海盗通缉令
    for 5
        SearchPiratesTemp = SearchPiratesTemp + 1
        if FindImage("海盗通缉令",3,1,0.6)=0 Then
            SearchPiratesByMonsterWanted = 0
            exit function
        end if
        call ClickAndDelay(10,10,1,1)
        if FindImage("通缉令弹出",3,1,0.6)= 1 Then
            exit for
        end if
        if SearchPiratesTemp >= 5 Then
            SearchPiratesByMonsterWanted = 0
            exit function
        End if
    next
    '等待找到海盗
    SearchPiratesTemp = 0
    SearchPiratesCnt = 0
    for 5
        SearchPiratesCnt = 0
        SearchPiratesTemp = SearchPiratesTemp + 1
        SearchPiratesCnt = SearchPiratesCnt + FindImage("海盗通缉令找到海盗证据1",1,1,0.9)
        SearchPiratesCnt = SearchPiratesCnt + FindImage("海盗通缉令找到海盗证据2",1,1,0.9)
        SearchPiratesCnt = SearchPiratesCnt + FindImage("海盗通缉令找到海盗证据3",1,1,0.9)
        '找到就退出循环
        if SearchPiratesCnt > 0 Then
            exit for
        end if
        '异常退出
        if SearchPiratesTemp >= 5 Then
            SearchPiratesByMonsterWanted = 0
            exit function
        end if
    next
    
    '点击相应海盗的图标，游戏会自动移动到海盗位置处
    if FindImage(NameOfPirate,6,1,0.7)=0 Then
            SearchPiratesByMonsterWanted = 0
            exit function
    end if
    call ClickAndDelay(30,30,1,5)
    
    '点击屏幕中间位置，弹出海盗信息
    MoveTo InitialX+CenterOfScreenX,InitialY+CenterOfScreenY
    Delay 1000
    LeftClick 1
    Delay 1000
    
    SearchPiratesByMonsterWanted = 1
end function

'通过飞机材料寻找海盗
'NameOfPlane：飞机名称：同温层堡垒 阿帕奇 猛禽
'NameOfMeterial：材料名称：融合核弹 太阳能 超级发动机
function SearchPiratesByPlaneMaterial(NameOfPlane,NameOfMeterial)
    SearchPiratesByPlaneMaterial = 0
    SearchPiratesCnt = 0
    SearchPiratesTemp = 0
    '确保我们在基地内部
    Call EnsureInBase()
    if FindImage("飞机工厂", 10, 1, 0.8) = 0 Then
        SearchPiratesByPlaneMaterial = 0
        exit function
    end if 
    call ClickAndDelay(25,25, 1, 1)
    '找到对应的飞机
    SearchPiratesTemp = 0
    for 3
        SearchPiratesTemp = SearchPiratesTemp + 1
        if FindImage(NameOfPlane, 2, 1, 0.5) = 0 Then
            call ShowPlane()
        else
            exit for
        end if
        if SearchPiratesTemp >= 3 Then
            SearchPiratesByPlaneMaterial = 0
            exit function
        end if
    next
    Call ClickAndDelay(35, 35, 1, 1)
    
    '点击升级 
    SearchPiratesTemp = 0
    For 10
        SearchPiratesTemp = SearchPiratesTemp + 1
        If FindImage("飞机升级按钮-已选中", 2, 1, 0.9) = 1 Then 
            Exit For
        Else 
            If FindImage("飞机升级按钮-未选中", 1, 1, 0.9) = 1 Then 
                Call ClickAndDelay(10,10, 1, 1)
            End If
        End If
        If SearchPiratesTemp >= 10 Then 
            SearchPiratesByPlaneMaterial = 0
            exit function
        End If
    Next
    
    '找到对应的材料
    If FindImage(NameOfMeterial, 10, 1, 0.8) = 0 Then 
        SearchPiratesByPlaneMaterial = 0
        exit function
    End If
    Call ClickAndDelay(10, 10, 1, 1)
    
    '前往海盗
    If FindImage("升级飞机前往海盗", 10, 1, 0.8) = 0 Then 
        SearchPiratesByPlaneMaterial = 0
        exit function
    End If
    Call ClickAndDelay(10, 10, 1, 6)
    
    '点击屏幕正中央，弹出海盗信息
    MoveTo InitialX+CenterOfScreenX,InitialY+CenterOfScreenY
    Delay 1000
    LeftClick 1
    Delay 1000
    
    SearchPiratesByPlaneMaterial = 1
end function

'获取航母等级
function GetPirateLevel()
    GetPirateLevel = 0
    GetPirateLevelTemp = 0
    '判断是否是20级海盗
    for 2
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV20-1",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV20-2",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV20-3",1,0,1)
    next
    if GetPirateLevelTemp > 0 Then 
        GetPirateLevel = 20
        exit function
    end if
    '判断是否是21级海盗
    for 2
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV21-1",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV21-2",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV21-3",1,0,1)
    next
    if GetPirateLevelTemp > 0 Then 
        GetPirateLevel = 21
        exit function
    end if
    '判断是否是25级海盗
    for 2
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV25-索马里",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV25-地中海",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV25-东海",1,0,1)
    Next
    if GetPirateLevelTemp > 0 Then 
        GetPirateLevel = 25
        exit function
    end if
    '判断是否是25级海盗
    for 2
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV23-索马里",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV23-索马里",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV23-索马里",1,0,1)
    Next
    if GetPirateLevelTemp > 0 Then 
        GetPirateLevel = 23
        exit function
    end if

end Function

'检查海盗，目前只检查等级
function CheckPirate(Wanted)
    CheckPirate = 0
    if GetPirateLevel() = Wanted Then
        '是我们需要的等级
        if FindImage("攻击", 4, 1, 0.9) = 0 Then
            CheckPirate = 0
            exit function
        end if
        call ClickAndDelay(5,5, 1, 1)
        CheckPirate = 1
    end if
end Function

'等待并发送航母
'WaitFor等待时长
'CarrierPhoto航母的图片"黄金加富尔"
'CarrierState航母状态"驻防中"
'航母必须放在前三的位置上
function SelectCarrier(CarrierPhoto,CarrierState,WaitFor)
    SelectCarrier = 0
    '确保我们在航母编辑列表
    If FindImage("航母编辑队列", 4, 1, 0.8) = 0 Then 
        SelectCarrier = 0
        Exit Function
    End If
    '找到待发送航母的图片 
    If FindImage(CarrierPhoto, 5, 1, 0.6) = 0 Then 
        '找不到就得下拉航母列表，再判断一次
        Call ShowCarrier()  
    End If
    
    '等待航母进入某种状态，点击进入编队配置
    If FindImage2(CarrierState,WaitFor,1,0.7,FindImageintX,FindImageintY,FindImageintX+150,FindImageintY+80) = 0 Then
        exit Function
    End if
    Call ClickAndDelay(0,0,1,1)
    SelectCarrier = 1
    
    'Call FindImageParamReset(150, 80)
    'MsgBox InitialX+FindImageOffsetX & "+" & InitialY+FindImageOffsetY
    'If FindImage(CarrierState, WaitFor, 1, 0.7) = 1 Then 
    ''    Call ClickAndDelay(0,0,1,1)
    ''    SelectCarrier = 1
    'end if
    'Call FindImageParamRecovery()
    
End Function

'配置并发送航母编队
'Type = 0 ：不携带战舰 
'Type = 1：携带战舰(6个T1)
Function ConfigAndSentCarrier(ConfigType)
    ConfigAndSentCarrier = 0
    If ConfigType = 0 Then 
        If FindImage("派遣", 2, 1, 0.7) = 1 Then 
            Call ClickAndDelay(10, 10, 1, 1)
            ConfigAndSentCarrier = 1
        End If
    End If
    
    If ConfigType = 1 Then 
        If FindImage("自动填充战舰", 2, 1, 0.7) = 1 Then 
            Call ClickAndDelay(10, 10, 1, 1)
            If FindImage("战舰填充完成", 4, 1, 1.0) = 1 Then 
                If FindImage("派遣", 2, 1, 0.7) = 1 Then 
                    Call ClickAndDelay(10, 10, 1, 1)
                    ConfigAndSentCarrier = 1
                End If
            End If
        End If
    End If 
End Function

'修理所有战船
Function RepairAllShips(WaitForBack,WaitForFix)
    RepairAllShips = 0
    i = 0
    Call EnsureInBase()
     
    If FindImage("码头", 10, 1, 0.7) = 1 Then 
        Call ClickAndDelay(25,25, 1, 1)
        i = i + 1
    End If
    
    If FindImage("维修厂", 10, 1, 0.8) = 1 Then 
        Call ClickAndDelay(5,5, 1, 1)
        i = i + 1
    End If

    If FindImage("维修当前队列", WaitForBack, 1, 0.8) = 1 Then 
        Call ClickAndDelay(5,5, 1, 1)
        i = i + 1
    End If

    If FindImage("维修", 10, 1, 0.8) = 1 Then 
        Call ClickAndDelay(5,5, 1, 1)
        i = i + 1
    End If

    If FindImage("维修完成", WaitForFix, 1, 0.8) = 1 Then 
        Call FindImage("返回键", 2, 2, 0.9)
        Call ClickAndDelay(20,20, 2, 2)
        i = i + 1
    End If
    
    If i = 5 Then 
        RepairAllShips = 1
    End If

End Function

'异常处理
function ExceptionProcess()
    '体力消耗殆尽 -> 关闭游戏
    if FindImage("体力值补充", 1, 1, 0.8) = 1 or FindImage("体力值补充2", 1, 1, 0.8) = 1 Then 
        call CloseGame()
        exit function
    end if
    if FindImage("取消按钮", 2, 1, 0.8) = 1 Then
        Call ClickAndDelay(10, 10, 1, 1)
    End if
    '一般处理情况是点击返回键
    Call PressReturnKey()
    Call EnsureInBase()
    Call EnsureOutOfBase()
    Call EnsureGameRuning()
end function

'返回为1则说明活动开始了0|2->3|5->6|8->9|
Function TimePlan_()
    '紧急海盗活动：2-3，10-11，18-19
    TimePlan_ = 0
    i = 0   
    Dim Plan
    Plan = Array(2,3,10,11,18,19)
    MyTime = Now
    MyHour = Hour(MyTime)
    For 3
        If MyHour >= Plan(i) and MyHour < Plan(i + 1) Then 
            TimePlan_ = 1
            Exit Function
        End If
        i = i + 2
    Next
End Function

'参数为等待时长，单位小时
Function TimePlan(Len)
    Call Show2User("将会等待 "&Len&"秒")
    TimePlanCnt = 0
    Counter = Len'秒
    if Counter <= 0 Then
        MsgBox "请给个合理的等待时长然后重启脚本"
    end if
    '第一次运行直接打海盗
    if TimePlanFirstRun = 1 Then 
        TimePlanFirstRun = 0
        exit function
    end if
    for Counter
        '海盗活动事件开始，自动启动打海盗
        If TimePlan_() = 1 Then 
            If TimePlanCnt <> 0 Then
                '如果在海盗活动期间启动，直接打海盗，不用等待
                Call Show2UserCountdown("海盗活动事件，等待启动游戏...........", 8 * 60)
            Else 
                Call Show2User("海盗活动事件，直接启动游戏")
            End If
            exit function
        end if
        '没有海盗活动的话，延迟满Len（一般是2）个小时退出
        Delay 1000
        TimePlanCnt = TimePlanCnt + 1
        Form1.Slider2.Value = Form1.Slider2.Value - 1
    Next
    
    Call Show2User("延迟结束。。。。")
end function

'攻击20级海盗
Function AttackLv20Pirate(SerialNumber)
	'SerialNumber = 1
    PirateName = Array("东海海盗","地中海海盗","索马里海盗")
    AttackLv20Pirate = 0
    NameOfPirate = PirateName(SerialNumber MOD 3)
    WantedLevel = 20
    for 10
        rem AttackLv20PirateLoop
        '搜索
        if SearchPiratesByMonsterWanted(NameOfPirate) = 0 Then
            call ExceptionProcess()
            goto AttackLv20PirateLoop
        end if
        '检查
        if CheckPirate(WantedLevel) = 0 Then
            call ExceptionProcess()
            goto AttackLv20PirateLoop
        end if
        '选航母
        if SelectCarrier("黄金加富尔","待命中",10*60) = 0 Then
            call ExceptionProcess()
            goto AttackLv20PirateLoop
        end if
        '配置航母&派遣
        if ConfigAndSentCarrier(0) = 0 Then
            call ExceptionProcess()
            goto AttackLv20PirateLoop
        end if
        LogOfAttack(SerialNumber & "-" & WantedLevel)
        AttackLv20Pirate = 1
        exit for
    next
End Function

'攻击21级海盗
Function AttackLv21Pirate(SerialNumber)
    'SerialNumber = 1'&*&^*&^*&%*&%*&&^^&%^&
    AttackLv21Pirate = 0
    NameOfPlanes = Array("同温层堡垒","阿帕奇","猛禽")
    NameOfMeterials = Array("融合核弹","太阳能","超级发动机")
    
    NameOfPlane = NameOfPlanes(SerialNumber MOD 3)
    NameOfMeterial = NameOfMeterials(SerialNumber MOD 3)
    WantedLevel = 21
    
    AttackLv21PirateCnt = 0
    
    for 10
    Rem AttackLv21PirateLoop
        AttackLv21PirateCnt = AttackLv21PirateCnt + 1
        If AttackLv21PirateCnt >= 40 Then 
            Exit Function
        End If
        
        if SearchPiratesByPlaneMaterial(NameOfPlane,NameOfMeterial) = 0 Then
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        
        if CheckPirate(WantedLevel) = 0 Then
            if GetPirateLevel() = 25 or GetPirateLevel() = 23 Then
                AttackLv21Pirate = 0
                exit function
            end if
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        
        if SelectCarrier("黄金加富尔","待命中",10*60) = 0 Then
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        
        if ConfigAndSentCarrier(1) = 0 Then
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        
        if RepairAllShips(10*60,10*60) = 0 Then 
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        LogOfAttack(SerialNumber & "-" & WantedLevel)
        AttackLv21Pirate = 1
        exit for
    next
End function

' 
'测试 Call AutoAttack("玩家TEST", "黄金加富尔", "待命中", 7*60)
Function AutoAttack(Target, AttackFleet, FleetState, TimeWaitFor)

    Call EnsureOutOfBase()
    '选中收藏
    if FindImage("收藏", 1, 1, 0.8) = 0 Then
        Exit function
    End if
    Call ClickAndDelay(10,10,2,2)
    
    '从收藏中寻找玩家，系统会自动移动到玩家位置
    if FindImage(Target, 1, 1, 0.8) = 0 Then
        Exit function
    End if
    Call ClickAndDelay(56,24,2,5)
    
    '点击屏幕正中间
    MoveTo InitialX+CenterOfScreenX,InitialY+CenterOfScreenY
    Delay 1000
    LeftClick 1
    Delay 1000
    
    '攻击玩家'
    if FindImage("攻击玩家", 6, 1, 0.8) = 0 Then
        Exit function
    End if
    Call ClickAndDelay(10,20,2,2)
    
    '选择航母
    if SelectCarrier(AttackFleet,FleetState,10*60) = 0 Then
        exit function
    End if
    
    '配置并发送航母
    if ConfigAndSentCarrier(0) = 0 Then
        Exit function
    End if
    
    '查看维修厂有没有需要修的船
    if RepairAllShips(TimeWaitFor,10) = 0 Then
        Exit function
    End If
    
end function

function MainTask()
    Call Init()
    cnt = 0
    Call Show2User("开始打海盗，数量限制为 "&AttackCounter)
    for 500
        If cnt >= AttackCounter Then 
            Exit for
        End If
        rem Restart
        if LocateTiantian()=0 Then
            goto Restart
        end if
        if EnsureGameRuning()=0 Then 
            goto Restart
        End If
        
        If AttackLv21Pirate(cnt) = 0 Then 
            If AttackLv20Pirate(cnt) = 0 Then 
            'If AttackLv20Pirate(2) = 0 Then 
                goto Restart
            End If
        End If
        cnt = cnt + 1
        Form1.Slider1.Value = Form1.Slider1.Value - 1
        'MsgBox cnt
    next
end function

'复合任务 
Function SynthesisTask() 
    Call ReloadParam1()
    For 1000
        Call TimePlan(TimePlanDelay)
        Call ReloadParam2()
        Call MainTask()
        Call CloseGame()
        Call ReloadParam2()
    Next
End Function
