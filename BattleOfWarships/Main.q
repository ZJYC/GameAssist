[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=115
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=ed06932a-7807-4b5d-a31f-d61e83527126
Description=带界面
Enable=0
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=Form1
[Relative]
SetupOCXFile=
[Comment]

[UIPackage]
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


[Script]
'------------------------------------------------
'本部分为图形界面部分
'------------------------------------------------
CenterOfScreenX = 184
CenterOfScreenY = 370

ImagePath = ""
TimePlanFirstRun = 0
TimePlanDelay = 0
AttackCounter = 0

InitialX=0
InitialY=0
FindImageintX=0
FindImageintY=0
FindImageOffsetX = 455
FindImageOffsetY = 765

InitialX_ = 0
InitialY_ = 0

Event Form1.Button1.Click

    If Form1.Slider1.Value = 0 Then 
        Call Show2User("系统默认攻击25个海盗")
        Form1.Slider1.Value = 30
    End If
    If Form1.Slider2.Value = 0 Then 
        Call Show2User("系统默认延迟2个小时")
        Form1.Slider2.Value = 7200
    End If
    If Form1.CheckBox1.Value = 1 Then 
        Call Show2User("用户选中-立即攻打海盗-")
    Else 
        Call Show2User("用户取消-立即攻打海盗-")
    End If
    Call Show2User("系统启动")
    Form1.Slider1.Enabled = 0
    Form1.Slider2.Enabled = 0
    Form1.CheckBox1.Enabled = 0
    Form1.Button1.Enabled = 0
End Event

Event Form1.Timer1.Timer
    Form1.Label2.Caption = Form1.Slider1.Value
    Form1.Label4.Caption = Second2TimeString(Form1.Slider2.Value)
    'If Form1.Slider2.Value MOD 2 = 0 Then 
   	'Form1.Label3.TextColor = &HF0FBFF
    'Else 
    '	Form1.Label3.TextColor = &H00FFFF
    'End If
End Event

Function Second2TimeString(Second)
    Second2TimeString = ""
    Second2TimeString = Second2TimeString & int(Second / 3600)
    Second = Second MOD 3600
    
    Second2TimeString = Second2TimeString + ":"
    Second2TimeString = Second2TimeString & int(Second / 60)
    Second = Second MOD 60
    
    Second2TimeString = Second2TimeString + ":"
    Second2TimeString = Second2TimeString & int(Second)
    
End Function

Function Show2User(Inf)
    vbCrLfCnt = 0
    For i = 1 To Len(Form1.InputBox1.Text)
        Char = Mid(Form1.InputBox1.Text, i, 1)
        If Char = vbLf Then 
            vbCrLfCnt = vbCrLfCnt + 1
        End if
    Next
    If vbCrLfCnt >= 7 Then 
        Form1.InputBox1.Text = Split(Form1.InputBox1.Text, vbCrLf, 2)(1)
    End If
    Form1.Label6.Caption = Inf
    Form1.InputBox1.Text = Form1.InputBox1.Text + Inf + vbCrLf
End Function

'向用户显示倒计时（百分比显示）
'Inf显示的信息
'延迟长度（秒）
'测试 Call Show2UserCountdown("XBSJHGJDHGDJ.....",200)
Function Show2UserCountdown(Inf,Length)
    Countdown = 0
    Countdown_ = 0
    For Length
        Delay 1000
        Countdown = Countdown + 1
        Countdown_ = Countdown_ + 1
        If Countdown_ >= Length / 100 Then 
            Countdown_ = 0
            Str = Inf & int(Countdown * 100 / Length) & "%"
            Show2User (Str)
        End If
    Next
End Function

Event Form1.CheckBox1.Click
    If Form1.CheckBox1.Value = 1 Then 
        Call Show2User("用户选中-立即攻打海盗-")
    Else 
        Call Show2User("用户取消-立即攻打海盗-")
    End If
End Event

'记录到文件，按照日期排序
Function Log(Inf)
    FileName = year(Date) & "-" & Month(Date) & "-" & Day(Date) & "-" & "Log.txt"
    Dim fso, f
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set f = fso.OpenTextFile(ImagePath & FileName, 8, True)
    f.WriteLine Date & "-" & Time & " : " & Inf
    f.Close
End Function

'记录攻击海盗事件
function LogOfAttack(Level)
    Call Show2User("成功攻击一次" & Level & "海盗")
    Call Log("成功攻击一次" & Level & "海盗")
End Function

'声音报警
Function Warning2User(cnt)
    For cnt
        Call Plugin.Media.Beep(1976, 100)
        Delay 200
    Next 
End Function

'本部分为游戏辅助部分

ImagePath = "C:\Users\Zhaojingyangchun\Desktop\游戏辅助\2\"

Call SynthesisTask()

'从UI更新数据，只在程序运行的第一次使用
Function ReloadParam1()
    ImagePath = Form1.InputBox2.Text
    TimePlanFirstRun = Form1.CheckBox1.Value
    '如下两个参数首次有效
    AttackCounter = Form1.Slider1.Value
    TimePlanDelay = Form1.Slider2.Value
End Function

'重新装填数据，周期型调用
Function ReloadParam2()
    '默认延迟两个小时
    Form1.Slider2.Value = 7200
    TimePlanDelay = 7200
    '默认攻击25个海盗
    Form1.Slider1.Value = 30
    AttackCounter = 30
    Form1.InputBox2.Text = ImagePath
    Form1.CheckBox1.Value = TimePlanFirstRun
End Function

'初始化一些参数
Function Init()
    InitialX=0
    InitialY=0
    FindImageintX=0
    FindImageintY=0
End Function

'重新设定图片寻找区域
Function FindImageParamReset(OffsetX,OffsetY)
    InitialX_ = InitialX
    InitialY_ = InitialY
    InitialX = FindImageintX
    InitialY = FindImageintY
    FindImageOffsetX = OffsetX
    FindImageOffsetY = OffsetY
End function

'恢复图片寻找区域
Function FindImageParamRecovery()
    InitialX = InitialX_
    InitialY = InitialY_
    FindImageOffsetX = 455
    FindImageOffsetY = 765
End function

'寻找图片
'基本功能同FindImage，不同之处在于，这里可以设定搜索范围 
'测试：FindImage2("待命中",5,1,0.7,InitialX,InitialY,InitialX+150,InitialY+80)
Function FindImage2(ImageName,Retry,rDelay,Rate,X1,Y1,X2,Y2)
    FindImage2 = 0
    while True
        FindPic X1,Y1,X2,Y2,ImagePath+ImageName+".bmp", Rate,FindImageintX,FindImageintY
        If FindImageintX> 0 And FindImageintY> 0 Then
            FindImage2 = 1
            Exit Function
        End if
        '重试
        Retry = Retry - 1
        If Retry > 0 Then
            Delay rDelay * 1000
        Else 
            Exit Function
        End If
    Wend
End function

'寻找图片
'ImageName  图片名称（此处尽量用中文名字方便理解）
'Retry      重试次数
'rDelay     重试延迟
'Rate       图片匹配率
'如果找到函数返回1，并把图片坐标存储到FindImageintX/Y
Function FindImage(ImageName,Retry,rDelay,Rate)
    FindImage = 0
    While True
        '如果没有定位过，需要全屏查找
        if InitialX=0 and InitialY=0 Then
            FindPic 0, 0, 1366, 768, ImagePath + ImageName + ".bmp", Rate, FindImageintX, FindImageintY
        Else
            FindPic InitialX,InitialY,InitialX+FindImageOffsetX,InitialY+FindImageOffsetY,ImagePath+ImageName+".bmp", _
            Rate,FindImageintX,FindImageintY
        End if
        If FindImageintX> 0 And FindImageintY> 0 Then
            FindImage = 1
            Exit Function
        End If
        
        Retry = Retry - 1
        If Retry > 0 Then
            Delay rDelay * 1000
        Else 
            Exit Function
        End If
    Wend
End Function

'关闭游戏
Function CloseGame()
    Call Show2User("开始关闭游戏")
    While 1
        If FindImage("返回键", 1, 0, 0.9) = 1 Then 
            Call ClickAndDelay(15,15, 2, 2)
            If FindImage("确定退出游戏", 1, 0, 0.9) = 1 Then 
                Call ClickAndDelay(10,10, 2, 2)
                Exit Function
            End If
        End If
        Delay 1000
    Wend
    Call Show2User("游戏已经关闭")
End Function

'点击返回键
function PressReturnKey()
    Call Show2User("返回键")
    If FindImage("返回键", 1, 0, 0.9) = 1 Then 
        Call ClickAndDelay(10,10, 1, 1)
    end if
End function

'定位天天模拟器的位置
function LocateTiantian()
    LocateTiantian = 0
    For 5
        if FindImage("TianTian",5,1,1.0) = 1 Then
            InitialX = FindImageintX
            InitialY = FindImageintY
            '???需要定位完成需要抹掉记录??--Bug
            MoveTo InitialX - 32, InitialY + 503
            Delay 200
            LocateTiantian = 1
            Exit Function 
        Else 
            Call Warning2User(25)
            MsgBox  "找不到天天模拟器，，，，，"
        End If
    Next 
end function

'判断游戏是否在运行
function IsGameRuning()
    IsGameRuning=0
    if FindImage("Run1",2,1,0.8)=1 Or FindImage("Run2",2,1,0.8)=1 Then
        IsGameRuning=1
    End if
End function

'点击+延迟
'OffsetX        坐标偏移
'OffsetY        坐标偏移
'DelayBefore    点击之前延迟
'DelayAfter     点击之后延迟
function ClickAndDelay(OffsetX,OffsetY,DelayBefore,DelayAfter)
    MoveTo FindImageintX+OffsetX,FindImageintY+OffsetY
    Delay DelayBefore*1000
    LeftClick 1
    Delay 500
    '不遮挡图片
    MoveTo InitialX - 32, InitialY + 503
    Delay DelayAfter * 1000
end function

'拖拽：起点x，y，次数，步数，步长x，y
Function Drag(x, y, Cnt, Steps, LenX, LenY)
    For Cnt
        MoveTo InitialX+x, InitialY+y
        Delay 500
        LeftDown 1
        Delay 500
        For Steps
            MoveR LenX,LenY 
            Delay 20
        Next
        Delay 500
        LeftUp 1
    Next
    MoveTo InitialX+x, InitialY+y
    Delay 1000
End Function

'将航母列表拉到头
function ShowCarrier()
    call Drag(206,375,5,150,0,2)
End Function

'将飞机列表向下移动
function ShowPlane()
    call Drag(206,375,1,70,0,-2)
end function

'确保游戏在运行
Function EnsureGameRuning()
    EnsureGameRuningCnt = 0
    EnsureGameRuning=0
    if IsGameRuning()=0 Then
        If FindImage("GameIcon", 2, 2, 0.6) = 1 Then 
            Call Show2User("启动游戏,请等待2分钟")
            Call ClickAndDelay(15, 15, 1, 1)
            call Show2UserCountdown("游戏正在启动，进度.........",2*60)
        Else 
            Call FindImage("返回键", 2, 2, 0.9)
            call ClickAndDelay(20,20,1,1)
        end if
    Else 
        EnsureGameRuning=1
    End if
end function

'确保我们在基地外部
function EnsureOutOfBase()
    EnsureOutOfBase = 0
    For 5
        if FindImage("Run2",1,0,0.8)=1 Then 
            EnsureOutOfBase = 1
            Exit For
        End if
        if EnsureOutOfBase=0 Then
            If FindImage("Run1", 1, 0, 0.8) = 0 Then 
                call PressReturnKey()
            Else 
                call ClickAndDelay(15,15,1,3)
            End If
            
        End If
    Next 
end function

'确保我们在基地内部
Function EnsureInBase()
    EnsureInBase = 0
    For 5
        if FindImage("Run1",1,0,0.8)=1 Then 
            EnsureInBase = 1
            Exit For
        End if
        if EnsureInBase=0 Then
            If FindImage("Run2", 1, 0, 0.8) = 0 Then 
                call PressReturnKey()
            Else 
                call ClickAndDelay(15,15,1,3)
            End If
            
        End If
    Next 
End Function

'通过海盗通缉令寻找海盗
'NameOfPirate 海盗名称：东海海盗 地中海海盗 索马里海盗
'返回1表示已经找到对应的海盗
function SearchPiratesByMonsterWanted(NameOfPirate)
    SearchPiratesCnt = 0
    SearchPiratesTemp = 0
    SearchPiratesByMonsterWanted = 0
    '确保我们在基地外部
    call EnsureOutOfBase()
    '点击海盗通缉令
    for 5
        SearchPiratesTemp = SearchPiratesTemp + 1
        if FindImage("海盗通缉令",3,1,0.6)=0 Then
            SearchPiratesByMonsterWanted = 0
            exit function
        end if
        call ClickAndDelay(10,10,1,1)
        if FindImage("通缉令弹出",3,1,0.6)= 1 Then
            exit for
        end if
        if SearchPiratesTemp >= 5 Then
            SearchPiratesByMonsterWanted = 0
            exit function
        End if
    next
    '等待找到海盗
    SearchPiratesTemp = 0
    SearchPiratesCnt = 0
    for 5
        SearchPiratesCnt = 0
        SearchPiratesTemp = SearchPiratesTemp + 1
        SearchPiratesCnt = SearchPiratesCnt + FindImage("海盗通缉令找到海盗证据1",1,1,0.9)
        SearchPiratesCnt = SearchPiratesCnt + FindImage("海盗通缉令找到海盗证据2",1,1,0.9)
        SearchPiratesCnt = SearchPiratesCnt + FindImage("海盗通缉令找到海盗证据3",1,1,0.9)
        '找到就退出循环
        if SearchPiratesCnt > 0 Then
            exit for
        end if
        '异常退出
        if SearchPiratesTemp >= 5 Then
            SearchPiratesByMonsterWanted = 0
            exit function
        end if
    next
    
    '点击相应海盗的图标，游戏会自动移动到海盗位置处
    if FindImage(NameOfPirate,6,1,0.7)=0 Then
            SearchPiratesByMonsterWanted = 0
            exit function
    end if
    call ClickAndDelay(30,30,1,5)
    
    '点击屏幕中间位置，弹出海盗信息
    MoveTo InitialX+CenterOfScreenX,InitialY+CenterOfScreenY
    Delay 1000
    LeftClick 1
    Delay 1000
    
    SearchPiratesByMonsterWanted = 1
end function

'通过飞机材料寻找海盗
'NameOfPlane：飞机名称：同温层堡垒 阿帕奇 猛禽
'NameOfMeterial：材料名称：融合核弹 太阳能 超级发动机
function SearchPiratesByPlaneMaterial(NameOfPlane,NameOfMeterial)
    SearchPiratesByPlaneMaterial = 0
    SearchPiratesCnt = 0
    SearchPiratesTemp = 0
    '确保我们在基地内部
    Call EnsureInBase()
    if FindImage("飞机工厂", 10, 1, 0.8) = 0 Then
        SearchPiratesByPlaneMaterial = 0
        exit function
    end if 
    call ClickAndDelay(25,25, 1, 1)
    '找到对应的飞机
    SearchPiratesTemp = 0
    for 3
        SearchPiratesTemp = SearchPiratesTemp + 1
        if FindImage(NameOfPlane, 2, 1, 0.5) = 0 Then
            call ShowPlane()
        else
            exit for
        end if
        if SearchPiratesTemp >= 3 Then
            SearchPiratesByPlaneMaterial = 0
            exit function
        end if
    next
    Call ClickAndDelay(35, 35, 1, 1)
    
    '点击升级 
    SearchPiratesTemp = 0
    For 10
        SearchPiratesTemp = SearchPiratesTemp + 1
        If FindImage("飞机升级按钮-已选中", 2, 1, 0.9) = 1 Then 
            Exit For
        Else 
            If FindImage("飞机升级按钮-未选中", 1, 1, 0.9) = 1 Then 
                Call ClickAndDelay(10,10, 1, 1)
            End If
        End If
        If SearchPiratesTemp >= 10 Then 
            SearchPiratesByPlaneMaterial = 0
            exit function
        End If
    Next
    
    '找到对应的材料
    If FindImage(NameOfMeterial, 10, 1, 0.8) = 0 Then 
        SearchPiratesByPlaneMaterial = 0
        exit function
    End If
    Call ClickAndDelay(10, 10, 1, 1)
    
    '前往海盗
    If FindImage("升级飞机前往海盗", 10, 1, 0.8) = 0 Then 
        SearchPiratesByPlaneMaterial = 0
        exit function
    End If
    Call ClickAndDelay(10, 10, 1, 6)
    
    '点击屏幕正中央，弹出海盗信息
    MoveTo InitialX+CenterOfScreenX,InitialY+CenterOfScreenY
    Delay 1000
    LeftClick 1
    Delay 1000
    
    SearchPiratesByPlaneMaterial = 1
end function

'获取航母等级
function GetPirateLevel()
    GetPirateLevel = 0
    GetPirateLevelTemp = 0
    '判断是否是20级海盗
    for 2
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV20-1",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV20-2",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV20-3",1,0,1)
    next
    if GetPirateLevelTemp > 0 Then 
        GetPirateLevel = 20
        exit function
    end if
    '判断是否是21级海盗
    for 2
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV21-1",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV21-2",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV21-3",1,0,1)
    next
    if GetPirateLevelTemp > 0 Then 
        GetPirateLevel = 21
        exit function
    end if
    '判断是否是25级海盗
    for 2
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV25-索马里",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV25-地中海",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV25-东海",1,0,1)
    Next
    if GetPirateLevelTemp > 0 Then 
        GetPirateLevel = 25
        exit function
    end if
    '判断是否是25级海盗
    for 2
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV23-索马里",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV23-索马里",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV23-索马里",1,0,1)
    Next
    if GetPirateLevelTemp > 0 Then 
        GetPirateLevel = 23
        exit function
    end if

end Function

'检查海盗，目前只检查等级
function CheckPirate(Wanted)
    CheckPirate = 0
    if GetPirateLevel() = Wanted Then
        '是我们需要的等级
        if FindImage("攻击", 4, 1, 0.9) = 0 Then
            CheckPirate = 0
            exit function
        end if
        call ClickAndDelay(5,5, 1, 1)
        CheckPirate = 1
    end if
end Function

'等待并发送航母
'WaitFor等待时长
'CarrierPhoto航母的图片"黄金加富尔"
'CarrierState航母状态"驻防中"
'航母必须放在前三的位置上
function SelectCarrier(CarrierPhoto,CarrierState,WaitFor)
    SelectCarrier = 0
    '确保我们在航母编辑列表
    If FindImage("航母编辑队列", 4, 1, 0.8) = 0 Then 
        SelectCarrier = 0
        Exit Function
    End If
    '找到待发送航母的图片 
    If FindImage(CarrierPhoto, 5, 1, 0.6) = 0 Then 
        '找不到就得下拉航母列表，再判断一次
        Call ShowCarrier()  
    End If
    
    '等待航母进入某种状态，点击进入编队配置
    If FindImage2(CarrierState,WaitFor,1,0.7,FindImageintX,FindImageintY,FindImageintX+150,FindImageintY+80) = 0 Then
        exit Function
    End if
    Call ClickAndDelay(0,0,1,1)
    SelectCarrier = 1
    
    'Call FindImageParamReset(150, 80)
    'MsgBox InitialX+FindImageOffsetX & "+" & InitialY+FindImageOffsetY
    'If FindImage(CarrierState, WaitFor, 1, 0.7) = 1 Then 
    ''    Call ClickAndDelay(0,0,1,1)
    ''    SelectCarrier = 1
    'end if
    'Call FindImageParamRecovery()
    
End Function

'配置并发送航母编队
'Type = 0 ：不携带战舰 
'Type = 1：携带战舰(6个T1)
Function ConfigAndSentCarrier(ConfigType)
    ConfigAndSentCarrier = 0
    If ConfigType = 0 Then 
        If FindImage("派遣", 2, 1, 0.7) = 1 Then 
            Call ClickAndDelay(10, 10, 1, 1)
            ConfigAndSentCarrier = 1
        End If
    End If
    
    If ConfigType = 1 Then 
        If FindImage("自动填充战舰", 2, 1, 0.7) = 1 Then 
            Call ClickAndDelay(10, 10, 1, 1)
            If FindImage("战舰填充完成", 4, 1, 1.0) = 1 Then 
                If FindImage("派遣", 2, 1, 0.7) = 1 Then 
                    Call ClickAndDelay(10, 10, 1, 1)
                    ConfigAndSentCarrier = 1
                End If
            End If
        End If
    End If 
End Function

'修理所有战船
Function RepairAllShips(WaitForBack,WaitForFix)
    RepairAllShips = 0
    i = 0
    Call EnsureInBase()
     
    If FindImage("码头", 10, 1, 0.7) = 1 Then 
        Call ClickAndDelay(25,25, 1, 1)
        i = i + 1
    End If
    
    If FindImage("增加城防值", 1, 1, 0.7) = 1 Then 
        Call ClickAndDelay(15,15, 1, 1)
        i = i + 1
    End If
    
    If FindImage("维修厂", 10, 1, 0.8) = 1 Then 
        Call ClickAndDelay(5,5, 1, 1)
        i = i + 1
    End If

    If FindImage("维修当前队列", WaitForBack, 1, 0.8) = 1 Then 
        Call ClickAndDelay(5,5, 1, 1)
        i = i + 1
    End If

    If FindImage("维修", 10, 1, 0.8) = 1 Then 
        Call ClickAndDelay(5,5, 1, 1)
        i = i + 1
    End If

    If FindImage("维修完成", WaitForFix, 1, 0.8) = 1 Then 
        Call FindImage("返回键", 2, 2, 0.9)
        Call ClickAndDelay(20,20, 2, 2)
        i = i + 1
    End If
    
    If i >= 5 Then 
        RepairAllShips = 1
    End If

End Function

'异常处理
function ExceptionProcess()
    '体力消耗殆尽 -> 关闭游戏
    If FindImage("体力值补充", 1, 1, 0.8) = 1 or FindImage("体力值补充2", 1, 1, 0.8) = 1 Then 
    	AttackCounter = 0
        'call CloseGame()
        Call Show2UserCountdown("体力值耗尽，等待启动游戏...........", 5*60)
        exit function
    end if
    if FindImage("取消按钮", 2, 1, 0.8) = 1 Then
        Call ClickAndDelay(10, 10, 1, 1)
    End if
    '一般处理情况是点击返回键
    Call PressReturnKey()
    Call EnsureInBase()
    Call EnsureOutOfBase()
    Call EnsureGameRuning()
end function

'返回为1则说明活动开始了0|2->3|5->6|8->9|
Function IsPirateEvent()
    '紧急海盗活动：2-3，10-11，18-19
    IsPirateEvent = 0
    i = 0   
    Dim Plan
    '2:8~2:30,10:8~10:30,18:8~18:30
    Plan = Array(2,8,2,40,10,8,10,40,18,8,18,40)
    '计算当前时间值
    MyTime = Now
    MyHour = Hour(MyTime)
    MyMinute = Minute((MyTime))
    CurTime = MyHour * 60 + MyMinute
    For 3
        StartTime = Plan(i) * 60 + Plan(i+1)
        EndTime = Plan(i+2) * 60 + Plan(i+3)
        
        If CurTime >= StartTime and CurTime <= EndTime Then 
            IsPirateEvent = 1
            Exit Function
        End If
        i = i + 4
    Next
End Function

'参数为等待时长，单位小时
Function TimePlan(Len)
    Call Show2User("将会等待 "&Len&"秒")
    TimePlanCnt = 0
    Counter = Len'秒
    if Counter <= 0 Then
        MsgBox "请给个合理的等待时长然后重启脚本"
    end if
    '第一次运行直接打海盗
    if TimePlanFirstRun = 1 Then 
        TimePlanFirstRun = 0
        exit function
    end if
    for Counter
        '海盗活动事件开始，自动启动打海盗
        If IsPirateEvent() = 1 Then 
            If TimePlanCnt <> 0 Then
                '如果在海盗活动期间启动，直接打海盗，不用等待
                Call Show2UserCountdown("海盗活动事件，等待启动游戏...........", 0)
            Else 
                Call Show2User("海盗活动事件，直接启动游戏")
            End If
            exit function
        end if
        '没有海盗活动的话，延迟满Len（一般是2）个小时退出
        Delay 1000
        TimePlanCnt = TimePlanCnt + 1
        Form1.Slider2.Value = Form1.Slider2.Value - 1
    Next
    
    Call Show2User("延迟结束。。。。")
end function

'攻击20级海盗
Function AttackLv20Pirate(SerialNumber)
    'SerialNumber = 1
    PirateName = Array("东海海盗","地中海海盗","索马里海盗")
    AttackLv20Pirate = 0
    NameOfPirate = PirateName(SerialNumber MOD 3)
    WantedLevel = 20
    for 10
        rem AttackLv20PirateLoop
        '搜索
        if SearchPiratesByMonsterWanted(NameOfPirate) = 0 Then
            call ExceptionProcess()
            goto AttackLv20PirateLoop
        end if
        '检查
        if CheckPirate(WantedLevel) = 0 Then
            call ExceptionProcess()
            goto AttackLv20PirateLoop
        end if
        '选航母
        if SelectCarrier("黄金加富尔","待命中",10*60) = 0 Then
            call ExceptionProcess()
            goto AttackLv20PirateLoop
        end if
        '配置航母&派遣
        if ConfigAndSentCarrier(0) = 0 Then
            call ExceptionProcess()
            goto AttackLv20PirateLoop
        end if
        LogOfAttack(SerialNumber & "-" & WantedLevel)
        AttackLv20Pirate = 1
        exit for
    next
End Function

'攻击21级海盗
Function AttackLv21Pirate(SerialNumber)
    'SerialNumber = 1'&*&^*&^*&%*&%*&&^^&%^&
    AttackLv21Pirate = 0
    NameOfPlanes = Array("同温层堡垒","阿帕奇","猛禽")
    NameOfMeterials = Array("融合核弹","太阳能","超级发动机")
    
    NameOfPlane = NameOfPlanes(SerialNumber MOD 3)
    NameOfMeterial = NameOfMeterials(SerialNumber MOD 3)
    WantedLevel = 21
    
    AttackLv21PirateCnt = 0
    
    for 10
    Rem AttackLv21PirateLoop
        AttackLv21PirateCnt = AttackLv21PirateCnt + 1
        If AttackLv21PirateCnt >= 40 Then 
            Exit Function
        End If
        
        if SearchPiratesByPlaneMaterial(NameOfPlane,NameOfMeterial) = 0 Then
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        
        if CheckPirate(WantedLevel) = 0 Then
            if GetPirateLevel() = 25 or GetPirateLevel() = 23 Then
                AttackLv21Pirate = 0
                exit function
            end if
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        
        if SelectCarrier("黄金加富尔","待命中",10*60) = 0 Then
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        
        if ConfigAndSentCarrier(1) = 0 Then
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        
        if RepairAllShips(10*60,10*60) = 0 Then 
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        LogOfAttack(SerialNumber & "-" & WantedLevel)
        AttackLv21Pirate = 1
        exit for
    next
End function

'测试 Call AutoAttack("玩家TEST", "黄金加富尔", "待命中", 7*60)
Function AutoAttack(Target, AttackFleet, FleetState, TimeWaitFor)

    Call EnsureOutOfBase()
    '选中收藏
    if FindImage("收藏", 1, 1, 0.8) = 0 Then
        Exit function
    End if
    Call ClickAndDelay(10,10,2,2)
    
    '从收藏中寻找玩家，系统会自动移动到玩家位置
    if FindImage(Target, 1, 1, 0.8) = 0 Then
        Exit function
    End if
    Call ClickAndDelay(56,24,2,5)
    
    '点击屏幕正中间
    MoveTo InitialX+CenterOfScreenX,InitialY+CenterOfScreenY
    Delay 1000
    LeftClick 1
    Delay 1000
    
    '攻击玩家'
    if FindImage("攻击玩家", 6, 1, 0.8) = 0 Then
        Exit function
    End if
    Call ClickAndDelay(10,20,2,2)
    
    '选择航母
    if SelectCarrier(AttackFleet,FleetState,10*60) = 0 Then
        exit function
    End if
    
    '配置并发送航母
    if ConfigAndSentCarrier(0) = 0 Then
        Exit function
    End if
    
    '查看维修厂有没有需要修的船
    if RepairAllShips(TimeWaitFor,10) = 0 Then
        Exit function
    End If
    
end function

function MainTask()
    Call Init()
    cnt = 0
    Call Show2User("开始打海盗，数量限制为 "&AttackCounter)
    for 500
        If cnt >= AttackCounter Then 
            Exit for
        End If
        rem Restart
        if LocateTiantian()=0 Then
            goto Restart
        end if
        if EnsureGameRuning()=0 Then 
            goto Restart
        End If
        
        If AttackLv21Pirate(cnt) = 0 Then 
            If AttackLv20Pirate(cnt) = 0 Then 
            'If AttackLv20Pirate(2) = 0 Then 
                goto Restart
            End If
        End If
        cnt = cnt + 1
        Form1.Slider1.Value = Form1.Slider1.Value - 1
        'MsgBox cnt
    next
end function

'复合任务 
Function SynthesisTask() 
    Call ReloadParam1()
    For 1000
        Call TimePlan(TimePlanDelay)
        Call ReloadParam2()
        Call MainTask()
        Call CloseGame()
        Call ReloadParam2()
    Next
End Function
