[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=115
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=ed06932a-7807-4b5d-a31f-d61e83527126
Description=帝国大海战
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=Form1
[Relative]
SetupOCXFile=
[Comment]

[UIPackage]
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


[Script]
'------------------------------------------------
'本部分为图形界面部分
'------------------------------------------------
CenterOfScreenX = 184
CenterOfScreenY = 370

ImagePath = ""
TimePlanFirstRun = 0
TimePlanDelay = 0
AttackCounter = 0

InitialX=0
InitialY=0
FindImageintX=0
FindImageintY=0
FindImageOffsetX = 455
FindImageOffsetY = 765

InitialX_ = 0
InitialY_ = 0

'声音报警
Function Warning2User(cnt)
    For cnt
        Call Plugin.Media.Beep(1976, 100)
        Delay 200
    Next 
End Function

'本部分为游戏辅助部分

ImagePath = "C:\Users\Zhaojingyangchun\Desktop\GA\GameAssist-master\BattleOfWarships\Picture\"

'初始化一些参数
Function Init()
    InitialX=0
    InitialY=0
    FindImageintX=0
    FindImageintY=0
End Function

'重新设定图片寻找区域
Function FindImageParamReset(OffsetX,OffsetY)
    InitialX_ = InitialX
    InitialY_ = InitialY
    InitialX = FindImageintX
    InitialY = FindImageintY
    FindImageOffsetX = OffsetX
    FindImageOffsetY = OffsetY
End function

'恢复图片寻找区域
Function FindImageParamRecovery()
    InitialX = InitialX_
    InitialY = InitialY_
    FindImageOffsetX = 455
    FindImageOffsetY = 765
End function

'寻找图片
'基本功能同FindImage，不同之处在于，这里可以设定搜索范围 
'测试：FindImage2("待命中",5,1,0.7,InitialX,InitialY,InitialX+150,InitialY+80)
Function FindImage2(ImageName,Retry,rDelay,Rate,X1,Y1,X2,Y2)
    FindImage2 = 0
    While True
        FindPic X1,Y1,X2,Y2,ImagePath+ImageName+".bmp", Rate,FindImageintX,FindImageintY
        If FindImageintX> 0 And FindImageintY> 0 Then
            FindImage2 = 1
            Exit Function
        End if
        '重试
        Retry = Retry - 1
        If Retry > 0 Then
            Delay rDelay * 1000
        Else 
            Exit Function
        End If
    Wend
End function

'寻找图片
'ImageName  图片名称（此处尽量用中文名字方便理解）
'Retry      重试次数
'rDelay     重试延迟
'Rate       图片匹配率
'如果找到函数返回1，并把图片坐标存储到FindImageintX/Y
Function FindImage(ImageName,Retry,rDelay,Rate)
    FindImage = 0
    While True
        '如果没有定位过，需要全屏查找
        if InitialX=0 and InitialY=0 Then
            FindPic 0, 0, 1366, 768, ImagePath + ImageName + ".bmp", Rate, FindImageintX, FindImageintY
        Else
            FindPic InitialX,InitialY,InitialX+FindImageOffsetX,InitialY+FindImageOffsetY,ImagePath+ImageName+".bmp", _
            Rate,FindImageintX,FindImageintY
        End if
        If FindImageintX> 0 And FindImageintY> 0 Then
            FindImage = 1
            Exit Function
        End If
        
        Retry = Retry - 1
        If Retry > 0 Then
            Delay rDelay * 1000
        Else 
            Exit Function
        End If
    Wend
End Function

'关闭游戏
Function CloseGame()
    Call Show2User("开始关闭游戏")
    While 1
        If FindImage("返回键", 1, 0, 0.9) = 1 Then 
            Call ClickAndDelay(15,15, 2, 2)
            If FindImage("确定退出游戏", 1, 0, 0.9) = 1 Then 
                Call ClickAndDelay(10,10, 2, 2)
                Exit Function
            End If
        End If
        Delay 1000
    Wend
    Call Show2User("游戏已经关闭")
End Function

'点击返回键
function PressReturnKey(Num)
    If FindImage("返回键", 1, 0, 0.9) = 1 Then 
    	For Num
        	Call ClickAndDelay(10, 10, 1, 1)
        Next
    end if
End function

'定位天天模拟器的位置
function LocateTiantian()
    LocateTiantian = 0
    For 5
        if FindImage("TianTian",5,1,1.0) = 1 Then
            InitialX = FindImageintX
            InitialY = FindImageintY
            '???需要定位完成需要抹掉记录??--Bug
            MoveTo InitialX - 32, InitialY + 503
            Delay 200
            LocateTiantian = 1
            Exit Function 
        Else 
            Call Warning2User(25)
            MsgBox  "找不到天天模拟器，，，，，"
        End If
    Next 
end function

'判断游戏是否在运行
function IsGameRuning()
    IsGameRuning=0
    if FindImage("Run1",2,1,0.8)=1 Or FindImage("Run2",2,1,0.8)=1 Then
        IsGameRuning=1
    End if
End function

'点击+延迟
'OffsetX        坐标偏移
'OffsetY        坐标偏移
'DelayBefore    点击之前延迟
'DelayAfter     点击之后延迟
function ClickAndDelay(OffsetX,OffsetY,DelayBefore,DelayAfter)
    MoveTo FindImageintX+OffsetX,FindImageintY+OffsetY
    Delay DelayBefore*1000
    LeftClick 1
    Delay 500
    '不遮挡图片
    MoveTo InitialX - 32, InitialY + 503
    Delay DelayAfter * 1000
end function

'拖拽：起点x，y，次数，步数，步长x，y
Function Drag(x, y, Cnt, Steps, LenX, LenY)
    For Cnt
        MoveTo InitialX+x, InitialY+y
        Delay 500
        LeftDown 1
        Delay 500
        For Steps
            MoveR LenX,LenY 
            Delay 20
        Next
        Delay 500
        LeftUp 1
    Next
    MoveTo InitialX+x, InitialY+y
    Delay 1000
End Function

'将航母列表拉到头
function ShowCarrier()
    call Drag(206,375,3,150,0,2)
End Function

'将飞机列表向下移动
function ShowPlane()
    call Drag(206,375,1,70,0,-2)
end function

'确保游戏在运行
Function EnsureGameRuning()
    EnsureGameRuningCnt = 0
    EnsureGameRuning=0
    if IsGameRuning()=0 Then
        If FindImage("GameIcon", 2, 2, 0.6) = 1 Then 
            Call Show2User("启动游戏,请等待2分钟")
            Call ClickAndDelay(15, 15, 1, 1)
            call Show2UserCountdown("游戏正在启动，进度.........",2*60)
        Else 
            Call FindImage("返回键", 2, 2, 0.9)
            call ClickAndDelay(20,20,1,1)
        end if
    Else 
        EnsureGameRuning=1
    End if
end function

'确保我们在基地外部
function EnsureOutOfBase()
    EnsureOutOfBase = 0
    For 5
        if FindImage("Run2",1,0,0.8)=1 Then 
            EnsureOutOfBase = 1
            Exit For
        End if
        if EnsureOutOfBase=0 Then
            If FindImage("Run1", 1, 0, 0.8) = 0 Then 
                call PressReturnKey(1)
            Else 
                call ClickAndDelay(15,15,1,3)
            End If
            
        End If
    Next 
end function

'确保我们在基地内部
Function EnsureInBase()
    EnsureInBase = 0
    For 5
        if FindImage("Run1",1,0,0.8)=1 Then 
            EnsureInBase = 1
            Exit For
        End if
        if EnsureInBase=0 Then
            If FindImage("Run2", 1, 0, 0.8) = 0 Then 
                call PressReturnKey(1)
            Else 
                call ClickAndDelay(15,15,1,3)
            End If
            
        End If
    Next 
End Function

'通过海盗通缉令寻找海盗
'NameOfPirate 海盗名称：东海海盗 地中海海盗 索马里海盗
'返回1表示已经找到对应的海盗
function SearchPiratesByMonsterWanted(NameOfPirate)
    SearchPiratesCnt = 0
    SearchPiratesTemp = 0
    SearchPiratesByMonsterWanted = 0
    '确保我们在基地外部
    call EnsureOutOfBase()
    '点击海盗通缉令
    for 5
        SearchPiratesTemp = SearchPiratesTemp + 1
        if FindImage("海盗通缉令",3,1,0.6)=0 Then
            SearchPiratesByMonsterWanted = 0
            exit function
        end if
        call ClickAndDelay(10,10,1,1)
        if FindImage("通缉令弹出",3,1,0.6)= 1 Then
            exit for
        end if
        if SearchPiratesTemp >= 5 Then
            SearchPiratesByMonsterWanted = 0
            exit function
        End if
    next
    '等待找到海盗
    SearchPiratesTemp = 0
    SearchPiratesCnt = 0
    for 5
        SearchPiratesCnt = 0
        SearchPiratesTemp = SearchPiratesTemp + 1
        SearchPiratesCnt = SearchPiratesCnt + FindImage("海盗通缉令找到海盗证据1",1,1,0.9)
        SearchPiratesCnt = SearchPiratesCnt + FindImage("海盗通缉令找到海盗证据2",1,1,0.9)
        SearchPiratesCnt = SearchPiratesCnt + FindImage("海盗通缉令找到海盗证据3",1,1,0.9)
        '找到就退出循环
        if SearchPiratesCnt > 0 Then
            exit for
        end if
        '异常退出
        if SearchPiratesTemp >= 5 Then
            SearchPiratesByMonsterWanted = 0
            exit function
        end if
    next
    
    '点击相应海盗的图标，游戏会自动移动到海盗位置处
    if FindImage(NameOfPirate,6,1,0.7)=0 Then
            SearchPiratesByMonsterWanted = 0
            exit function
    end if
    call ClickAndDelay(30,30,1,5)
    
    '点击屏幕中间位置，弹出海盗信息
    MoveTo InitialX+CenterOfScreenX,InitialY+CenterOfScreenY
    Delay 1000
    LeftClick 1
    Delay 1000
    
    SearchPiratesByMonsterWanted = 1
end function

'通过飞机材料寻找海盗
'NameOfPlane：飞机名称：同温层堡垒 阿帕奇 猛禽
'NameOfMeterial：材料名称：融合核弹 太阳能 超级发动机
function SearchPiratesByPlaneMaterial(NameOfPlane,NameOfMeterial)
    SearchPiratesByPlaneMaterial = 0
    SearchPiratesCnt = 0
    SearchPiratesTemp = 0
    '确保我们在基地内部
    Call EnsureInBase()
    if FindImage("飞机工厂", 10, 1, 0.8) = 0 Then
        SearchPiratesByPlaneMaterial = 0
        exit function
    end if 
    call ClickAndDelay(25,25, 1, 1)
    '找到对应的飞机
    SearchPiratesTemp = 0
    for 3
        SearchPiratesTemp = SearchPiratesTemp + 1
        if FindImage(NameOfPlane, 2, 1, 0.5) = 0 Then
            call ShowPlane()
        else
            exit for
        end if
        if SearchPiratesTemp >= 3 Then
            SearchPiratesByPlaneMaterial = 0
            exit function
        end if
    next
    Call ClickAndDelay(35, 35, 1, 1)
    
    '点击升级 
    SearchPiratesTemp = 0
    For 10
        SearchPiratesTemp = SearchPiratesTemp + 1
        If FindImage("飞机升级按钮-已选中", 2, 1, 0.9) = 1 Then 
            Exit For
        Else 
            If FindImage("飞机升级按钮-未选中", 1, 1, 0.9) = 1 Then 
                Call ClickAndDelay(10,10, 1, 1)
            End If
        End If
        If SearchPiratesTemp >= 10 Then 
            SearchPiratesByPlaneMaterial = 0
            exit function
        End If
    Next
    
    '找到对应的材料
    If FindImage(NameOfMeterial, 10, 1, 0.8) = 0 Then 
        SearchPiratesByPlaneMaterial = 0
        exit function
    End If
    Call ClickAndDelay(10, 10, 1, 1)
    
    '前往海盗
    If FindImage("升级飞机前往海盗", 10, 1, 0.8) = 0 Then 
        SearchPiratesByPlaneMaterial = 0
        exit function
    End If
    Call ClickAndDelay(10, 10, 1, 6)
    
    '点击屏幕正中央，弹出海盗信息
    MoveTo InitialX+CenterOfScreenX,InitialY+CenterOfScreenY
    Delay 1000
    LeftClick 1
    Delay 1000
    
    SearchPiratesByPlaneMaterial = 1
end function

'获取航母等级
function GetPirateLevel()
    GetPirateLevel = 0
    GetPirateLevelTemp = 0
    '判断是否是20级海盗
    for 2
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV20-1",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV20-2",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV20-3",1,0,1)
    next
    if GetPirateLevelTemp > 0 Then 
        GetPirateLevel = 20
        exit function
    end if
    '判断是否是21级海盗
    for 2
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV21-1",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV21-2",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV21-3",1,0,1)
    next
    if GetPirateLevelTemp > 0 Then 
        GetPirateLevel = 21
        exit function
    end if
    '判断是否是25级海盗
    for 2
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV25-索马里",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV25-地中海",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV25-东海",1,0,1)
    Next
    if GetPirateLevelTemp > 0 Then 
        GetPirateLevel = 25
        exit function
    end if
    '判断是否是25级海盗
    for 2
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV23-索马里",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV23-索马里",1,0,1)
        GetPirateLevelTemp = GetPirateLevelTemp + FindImage("LV23-索马里",1,0,1)
    Next
    if GetPirateLevelTemp > 0 Then 
        GetPirateLevel = 23
        exit function
    end if

end Function

'检查海盗，目前只检查等级
function CheckPirate(Wanted)
    CheckPirate = 0
    if GetPirateLevel() = Wanted Then
        '是我们需要的等级
        if FindImage("攻击", 4, 1, 0.9) = 0 Then
            CheckPirate = 0
            exit function
        end if
        Call ClickAndDelay(5, 5, 1, 1)
        CheckPirate = 1
    end if
end Function

'等待并发送航母
'WaitFor等待时长
'CarrierPhoto航母的图片"黄金加富尔"
'CarrierState航母状态"驻防中"
'航母必须放在前三的位置上
function SelectCarrier(CarrierPhoto,CarrierState,WaitFor)
    SelectCarrier = 0
    '确保我们在航母编辑列表
    If FindImage("航母编辑队列", 4, 1, 0.8) = 0 Then 
        SelectCarrier = 0
        Exit Function
    End If
    '找到待发送航母的图片 
    For 3
    	If FindImage(CarrierPhoto, 5, 1, 0.6) = 0 Then 
        	'找不到就得下拉航母列表，再判断一次
        	Call ShowCarrier()
        	Delay 3 * 1000
        Else 
        	Exit For
    	End If
    Next
    '等待航母进入某种状态，点击进入编队配置
    If FindImage2(CarrierState,WaitFor,1,0.7,FindImageintX,FindImageintY,FindImageintX+150,FindImageintY+80) = 0 Then
        exit Function
    End if
    Call ClickAndDelay(0,0,1,1)
    SelectCarrier = 1
End Function

'配置并发送航母编队
'Type = 0 ：不携带战舰 
'Type = 1：携带战舰(6个T1)
Function ConfigAndSentCarrier(ConfigType)
    ConfigAndSentCarrier = 0
    If ConfigType = 0 Then 
        If FindImage("派遣", 2, 1, 0.7) = 1 Then 
            Call ClickAndDelay(10, 10, 1, 1)
            ConfigAndSentCarrier = 1
        End If
    End If
    
    If ConfigType = 1 Then 
        If FindImage("自动填充战舰", 2, 1, 0.7) = 1 Then 
            Call ClickAndDelay(10, 10, 1, 1)
            'If FindImage("战舰填充完成", 4, 1, 1.0) = 1 Then 
                If FindImage("派遣", 2, 1, 0.7) = 1 Then 
                    Call ClickAndDelay(10, 10, 1, 1)
                    ConfigAndSentCarrier = 1
                End If
            'End If
        End If
    End If 
End Function

'修理所有战船
Function RepairAllShips(WaitForBack,WaitForFix)
    RepairAllShips = 0
    i = 0
    Call EnsureInBase()
     
    If FindImage("码头", 10, 1, 0.7) = 1 Then 
        Call ClickAndDelay(25,25, 1, 1)
        i = i + 1
    End If
    
   	If FindImage("增加城防值", 1, 1, 0.7) = 1 Then 
   	    Call ClickAndDelay(15,15, 1, 1)
        i = i + 1
    End If
    
    If FindImage("维修厂", 10, 1, 0.8) = 1 Then 
        Call ClickAndDelay(5,5, 1, 1)
        i = i + 1
    End If

    If FindImage("维修当前队列", WaitForBack, 1, 0.8) = 1 Then 
        Call ClickAndDelay(5,5, 1, 1)
        i = i + 1
    End If

    If FindImage("维修", 10, 1, 0.8) = 1 Then 
        Call ClickAndDelay(5,5, 1, 1)
        i = i + 1
    End If

    If FindImage("维修完成", WaitForFix, 1, 0.8) = 1 Then 
        Call FindImage("返回键", 2, 2, 0.9)
        Call ClickAndDelay(20,20, 2, 2)
        i = i + 1
    End If
    
    If i >= 5 Then 
        RepairAllShips = 1
    End If

End Function

'在码头检查航母是不是回来了
Function WaitCarierBack(Name,Time)
	WaitCarierBack = 0
	Call LocateTiantian()
	Call EnsureInBase()
	If FindImage("码头", 10, 1, 0.7) = 1 Then 
        Call ClickAndDelay(25,25, 1, 1)
    End If
    If FindImage(Name, 10, 1, 0.5) = 1 Then 
       	Call ClickAndDelay(25, 25, 1, 1)
       	If FindImage("码头内舰队确定", Time, 1, 0.7) = 1 Then 
       		Call PressReturnKey(2)
       		WaitCarierBack = 1
       	End If
    End If
End Function

'异常处理
function ExceptionProcess()
    '体力消耗殆尽 -> 关闭游戏
    If FindImage("体力值补充", 1, 1, 0.8) = 1 or FindImage("体力值补充2", 1, 1, 0.8) = 1 Then 
    	AttackCounter = 100
        'call CloseGame()
        'Call Show2UserCountdown("体力值耗尽，等待启动游戏...........", 5*60)
        exit function
    end if
    if FindImage("取消按钮", 2, 1, 0.8) = 1 Then
        Call ClickAndDelay(10, 10, 1, 1)
    End if
    '一般处理情况是点击返回键
    Call PressReturnKey(1)
    Call EnsureInBase()
    Call EnsureOutOfBase()
    Call EnsureGameRuning()
end function

'攻击21级海盗
Function AttackLv21Pirate(SerialNumber)
    'SerialNumber = 1'&*&^*&^*&%*&%*&&^^&%^&
    AttackLv21Pirate = 0
    NameOfPlanes = Array("同温层堡垒","阿帕奇","猛禽")
    NameOfMeterials = Array("融合核弹","太阳能","超级发动机")
    
    NameOfPlane = NameOfPlanes(SerialNumber MOD 3)
    NameOfMeterial = NameOfMeterials(SerialNumber MOD 3)
    WantedLevel = 21
    
    AttackLv21PirateCnt = 0
    
    Call LocateTiantian()
    
    for 10
    Rem AttackLv21PirateLoop
        AttackLv21PirateCnt = AttackLv21PirateCnt + 1
        If AttackLv21PirateCnt >= 40 Then 
            Exit Function
        End If
        
        if SearchPiratesByPlaneMaterial(NameOfPlane,NameOfMeterial) = 0 Then
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        
        if CheckPirate(WantedLevel) = 0 Then
            AttackLv21Pirate = 100
            exit function
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        
        If FindImage("使用体力值", 10, 1, 0.7) = 1 Then 
        	AttackLv21Pirate = 50
        	call PressReturnKey(2)
        	exit function
        End If
        
        if SelectCarrier("黄金加富尔","驻防中",10*60) = 0 Then
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        
        if ConfigAndSentCarrier(0) = 0 Then
            call ExceptionProcess()
            goto AttackLv21PirateLoop
        End if
        
        'if RepairAllShips(10*60,10*60) = 0 Then 
        '    call ExceptionProcess()
        '    goto AttackLv21PirateLoop
        'End if
        Call WaitCarierBack("黄金加富尔",10*60)
        'LogOfAttack(SerialNumber & "-" & WantedLevel)
        AttackLv21Pirate = 1
        exit for
    next
End function

Function ClearAPP()
	Call LocateTiantian()
	/////////////////////////////
	If FindImage("回家键", 4, 1, 1) = 1 Then 
		Call ClickAndDelay(15, 15, 1, 1)	
	End If
	/////////////////////////////
	If FindImage("系统工具", 4, 1, 0.9) = 1 Then 
		Call ClickAndDelay(15, 15, 1, 1)	
	End If
	/////////////////////////////
	If FindImage("设置", 4, 1, 0.9) = 1 Then 
		Call ClickAndDelay(15, 15, 1, 1)	
	End If
	/////////////////////////////
	If FindImage("应用", 4, 1, 0.9) = 1 Then 
		Call ClickAndDelay(15, 15, 1, 1)	
	End If
	/////////////////////////////
	If FindImage("海战游戏", 4, 1, 0.9) = 1 Then 
		Call ClickAndDelay(15, 15, 1, 1)	
	End If
	/////////////////////////////
	If FindImage("清除数据", 4, 1, 0.9) = 1 Then 
		Call ClickAndDelay(15, 15, 1, 1)
	Else 
		Exit function
	End If
	/////////////////////////////
	If FindImage("确定清除数据", 4, 1, 0.9) = 1 Then 
		Call ClickAndDelay(15, 15, 1, 1)	
	End If
	/////////////////////////////
	If FindImage("回家键", 4, 1, 1) = 1 Then 
		Call ClickAndDelay(15, 15, 1, 1)	
	End If
	
End Function

Function HuntPirate()
	Res = 0
	Call LocateTiantian()
	/////////////////////////////
	Call EnsureGameRuning()
	/////////////////////////////
	Call EnsureInBase()
	/////////////////////////////
	MoveTo InitialX + 30, InitialY + 214
	Delay 1000
    LeftClick 1
    Delay 1000
    /////////////////////////////
	If FindImage("活动列表", 4, 1, 0.8) = 1 Then 	
	Else 
		If FindImage("返回键", 4, 1, 1) = 1 Then 
			Call ClickAndDelay(5, 5, 1, 1)
		End If
	End If
	/////////////////////////////
	If FindImage("海盗活动图标", 4, 1, 0.9) = 1 Then 
		Call ClickAndDelay(5, 5, 1, 1)
	Else 
		If FindImage("返回键", 4, 1, 1) = 1 Then 
			Call ClickAndDelay(5, 5, 2, 1)
		End If
		Exit Function
	End If
	/////////////////////////////
	If FindImage("海盗活动尚未开始", 4, 1, 0.8) = 1 Then 
		If FindImage("返回键", 4, 1, 1) = 1 Then 
			Call ClickAndDelay(5, 5, 2, 1)
			Call ClickAndDelay(5, 5, 2, 1)
		End If
		Exit Function
	End If
	/////////////////////////////
	If FindImage("返回键", 4, 1, 1) = 1 Then 
		Call ClickAndDelay(5, 5, 2, 1)
		Call ClickAndDelay(5, 5, 2, 1)
	End If
	/////////////////////////////
	AttackCounter = 0
	For 500
		If AttackCounter >= 60 Then 
			Exit Function
		End If
		Res = AttackLv21Pirate(0)
		If Res = 100 Then 
			Call ClearAPP()
			Call EnsureGameRuning()
		End If
		If Res = 50 Then 
			Exit Function
		End If 
	Next	
End Function

Function WorldBoss()
	Call LocateTiantian()
	/////////////////////////////
	Call EnsureGameRuning()
	/////////////////////////////
	Call EnsureInBase()
	/////////////////////////////
	For 5
		/////////////////////////////
		MoveTo InitialX + 30, InitialY + 214
		Delay 1000
    	LeftClick 1
    	Delay 1000
    	/////////////////////////////
		If FindImage("活动列表", 4, 1, 0.8) = 1 Then 
			Exit For
		Else 
			If FindImage("返回键", 4, 1, 1) = 1 Then 
				Call ClickAndDelay(5, 5, 1, 1)
			End If
		End If
	next
/////////////////////////////
	If FindImage("世界BOSS开始", 10, 0.5, 0.6) = 1 Then 
		Call ClickAndDelay(5,5,1,1)
	Else 
		If FindImage("返回键", 4, 1, 1) = 1 Then 
		Call ClickAndDelay(5, 5, 1, 1)
		End If
		Exit Function
	End If
/////////////////////////////
	If FindImage("世界BOSS坐标", 4, 1, 0.8) = 1 Then 
		Call ClickAndDelay(6,6,1,1)
	Else 
		Exit Function
	End If
/////////////////////////////
	MoveTo InitialX+CenterOfScreenX,InitialY+CenterOfScreenY
    Delay 1000
    LeftClick 1
    Delay 1000
/////////////////////////////
	If FindImage("世界BOSS攻击", 4, 1, 0.5) = 1 Then 
		Call ClickAndDelay(15,15,1,1)
	Else 
		Exit Function
	End If
/////////////////////////////	
	Call ShowCarrier()
	'Call Drag(206, 375, 1, 60, 0, -2)
/////////////////////////////
	cnt = 0
	FleetNames = Array("第2号编队","第3号编队","第4号编队","第5号编队","第6号编队","第7号编队","第8号编队","第9号编队","第10号编队")
	for 7
		/////////////////////////////
		If FindImage(FleetNames(cnt), 8, 1, 0.5) = 1 Then 
			Call ClickAndDelay(15,15,1,1)
		Else 
			'Call Drag(206, 375, 1, 50, 0, -2)
		End If
		/////////////////////////////
		If FindImage("自动填充战舰", 4, 1, 0.8) = 1 Then 
			Call ClickAndDelay(5,5,1,1)
		else 
			If FindImage("卸载全部战舰", 4, 1, 0.8) = 1 Then 
				Call ClickAndDelay(5, 5, 1, 1)
				Call ClickAndDelay(5, 5, 1, 1)
			End If
		End If
		/////////////////////////////
		If FindImage("派遣", 4, 1, 0.8) = 1 Then 
			Call ClickAndDelay(5,5,1,1)
		Else 
			Exit Function
		End If
		/////////////////////////////
		for 100
			If FindImage(FleetNames(cnt), 4, 1, 0.6) = 1 Then 
				Call ClickAndDelay(15,15,1,1)	
			End If
			/////////////////////////////
			If FindImage("自动填充战舰", 4, 1, 0.8) = 1 Then 
				Call ClickAndDelay(5, 5, 1, 1)
				Call ClickAndDelay(5, 5, 1, 1)
				Exit For	
			Else 
				If FindImage("卸载全部战舰", 4, 1, 0.8) = 1 Then 
					Call ClickAndDelay(5, 5, 1, 1)
					Exit For
				End If
			End If
		Next
		/////////////////////////////
		If FindImage("返回键", 4, 1, 1) = 1 Then 
			Call ClickAndDelay(5,5,1,1)
		Else 
			Exit Function
		End If
		/////////////////////////////
		
		/////////////////////////////
		If cnt >= 8 Then 
			Exit For
		Else 
			cnt = cnt + 1
		End If
		/////////////////////////////
		Call Drag(206, 375, 1, 60, 0, - 2 )
		Delay 6*1000
		/////////////////////////////
	Next
	/////////////////////////////
	call RepairAllShips(2,2)
	
End Function

'Call SynthesisTask()
While true
	'call AttackLv21Pirate(0)
	Call WorldBoss()
	Call HuntPirate()
	'Delay 60*1000
	'Call WaitCarierBack("黄金加富尔")
Wend

